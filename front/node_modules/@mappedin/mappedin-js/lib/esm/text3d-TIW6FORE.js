import{Aa as i,ga as H,va as S,wa as G,xa as U,ya as $}from"./chunk-7MMSKILE.js";import"./chunk-MEAXYDH5.js";import"./chunk-NCE64JTI.js";import{D as A,M as w,P as Z}from"./chunk-6XEFZ77W.js";import{a as V}from"./chunk-4O5ABVXW.js";import"./chunk-HALSTKAB.js";V();var g=new Z,n=new w,J=new w(0,0,1);async function ot(p,s,o,M){var m,k,d,t,x,h,T,y,f,l,c,O;let r=s.feature.properties,e=new S;s.textMesh=e,e.text=r.text,e.anchorX="center",e.anchorY="middle",e.textAlign=(m=r.align)!=null?m:"center",e.color=(k=r.color)!=null?k:"black",e.fontSize=r.fontSize||20;let a=(d=o.font)!=null?d:i.font;a?e.font=a:u?e.font=await u:e.font=await q(),e.outlineOpacity=(t=o.outlineOpacity)!=null?t:i.outlineOpacity,e.outlineColor=(x=o.outlineColor)!=null?x:i.outlineColor,e.outlineOffsetY=(h=o.outlineOffsetY)!=null?h:i.outlineOffsetY,e.outlineOffsetX=(T=o.outlineOffsetX)!=null?T:i.outlineOffsetX,e.outlineWidth=(y=o.outlineWidth)!=null?y:i.outlineWidth,e.outlineBlur=(f=o.outlineBlur)!=null?f:i.outlineBlur,e.strokeWidth=(l=o.strokeWidth)!=null?l:i.strokeWidth,e.strokeColor=(c=o.strokeColor)!=null?c:i.strokeColor,e.strokeOpacity=(O=o.strokeOpacity)!=null?O:i.strokeOpacity;let W=M(s.feature.geometry.coordinates);return e.position.copy(W),e.position.z=r.verticalOffset,e.rotation.z=A.degToRad(-r.rotation),e.userData={entityId:p.toString(),rotationZ:-r.rotation},{text:e}}async function it(p,s,o,M){var O,P,z,B,X,D,F,Y,b,E,I,R,v,_,L;let r=s.feature.properties,{textArea:e}=r;if(!e)throw new Error("textArea is required");let a=(O=o.margin)!=null?O:i.margin,[W,m,k,d]=Array.isArray(a)?a:[a,a,a,a],t=new S;t.text=r.content;let x=e.maxHeight-W-k,h=e.maxWidth-d-m;t.fontSize=Math.min(x,(P=o.fontSize)!=null?P:i.fontSize),t.color=(z=o.color)!=null?z:i.color,t.maxWidth=(B=o.maxWidth)!=null?B:h,t.anchorX="center",t.anchorY="middle",t.textAlign="center";let T=(X=o.font)!=null?X:i.font;T?t.font=T:u?t.font=await u:t.font=await q(),t.outlineOpacity=(D=o.outlineOpacity)!=null?D:i.outlineOpacity,t.outlineColor=(F=o.outlineColor)!=null?F:i.outlineColor,t.outlineOffsetY=(Y=o.outlineOffsetY)!=null?Y:i.outlineOffsetY,t.outlineOffsetX=(b=o.outlineOffsetX)!=null?b:i.outlineOffsetX,t.outlineWidth=(E=o.outlineWidth)!=null?E:i.outlineWidth,t.outlineBlur=(I=o.outlineBlur)!=null?I:i.outlineBlur,t.strokeWidth=(R=o.strokeWidth)!=null?R:i.strokeWidth,t.strokeColor=(v=o.strokeColor)!=null?v:i.strokeColor,t.strokeOpacity=(_=o.strokeOpacity)!=null?_:i.strokeOpacity;let y=M(e.position,n);t.position.copy(y);let f=H(Math.PI/2-A.degToRad(e.rotation));t.rotation.z=f,t.userData={entityId:p.toString(),rotationZ:f};let l,c;try{c=(await $(t,h,x,t.fontSize*.2)).size}catch(j){throw(L=t.dispose)==null||L.call(t),new Error("Cannot fit text to area: entityId: ".concat(s.polygonEntityId," ").concat(j))}if(c)return g.identity(),n.set(0,0,1),g.makeRotationAxis(J,f),n.set(e.align==="near"?d+c[0]/2:e.maxWidth/2,0,0),n.applyMatrix4(g),t.position.x-=n.x,t.position.y-=n.y,s.textMesh=t,l&&(n.set(e.maxWidth/2,0,0),n.applyMatrix4(g),l.position.x-=n.x,l.position.y-=n.y),{text:t}}var u;function q(p){return u=U(p),u}export{G as BatchedText,S as Text,it as createTroikaTextArea,ot as createTroikaTextPoint,u as fontPreloadLoadPromise,q as preloadFont};
