import{b as X,n as ee,o as te,p as se,q as ie}from"./chunk-G2WDUYHG.js";import{G as g,H as Se,l as H}from"./chunk-7MMSKILE.js";import"./chunk-MEAXYDH5.js";import"./chunk-NCE64JTI.js";import"./chunk-6XEFZ77W.js";import{a as L}from"./chunk-4O5ABVXW.js";import{d as be,e as C,f as K,g as D,h as Y,i as Z}from"./chunk-HALSTKAB.js";L();L();function E(n,e,t,s){function i(o){return o instanceof t?o:new t(function(r){r(o)})}return new(t||(t=Promise))(function(o,r){function c(u){try{d(s.next(u))}catch(h){r(h)}}function a(u){try{d(s.throw(u))}catch(h){r(h)}}function d(u){u.done?o(u.value):i(u.value).then(c,a)}d((s=s.apply(n,e||[])).next())})}var xe="ENTRIES",ae="KEYS",ue="VALUES",y="",O=class{constructor(e,t){let s=e._tree,i=Array.from(s.keys());this.set=e,this._type=t,this._path=i.length>0?[{node:s,keys:i}]:[]}next(){let e=this.dive();return this.backtrack(),e}dive(){if(this._path.length===0)return{done:!0,value:void 0};let{node:e,keys:t}=z(this._path);if(z(t)===y)return{done:!1,value:this.result()};let s=e.get(z(t));return this._path.push({node:s,keys:Array.from(s.keys())}),this.dive()}backtrack(){if(this._path.length===0)return;let e=z(this._path).keys;e.pop(),!(e.length>0)&&(this._path.pop(),this.backtrack())}key(){return this.set._prefix+this._path.map(({keys:e})=>z(e)).filter(e=>e!==y).join("")}value(){return z(this._path).node.get(y)}result(){switch(this._type){case ue:return this.value();case ae:return this.key();default:return[this.key(),this.value()]}}[Symbol.iterator](){return this}},z=n=>n[n.length-1],ze=(n,e,t)=>{let s=new Map;if(e===void 0)return s;let i=e.length+1,o=i+t,r=new Uint8Array(o*i).fill(t+1);for(let c=0;c<i;++c)r[c]=c;for(let c=1;c<o;++c)r[c*i]=c;return de(n,e,t,s,r,1,i,""),s},de=(n,e,t,s,i,o,r,c)=>{let a=o*r;e:for(let d of n.keys())if(d===y){let u=i[a-1];u<=t&&s.set(c,[n.get(d),u])}else{let u=o;for(let h=0;h<d.length;++h,++u){let l=d[h],p=r*u,_=p-r,f=i[p],m=Math.max(0,u-t-1),S=Math.min(r-1,u+t);for(let b=m;b<S;++b){let V=l!==e[b],R=i[_+b]+ +V,M=i[_+b+1]+1,w=i[p+b]+1,I=i[p+b+1]=Math.min(R,M,w);I<f&&(f=I)}if(f>t)continue e}de(n.get(d),e,t,s,i,u,r,c+d)}},v=class n{constructor(e=new Map,t=""){this._size=void 0,this._tree=e,this._prefix=t}atPrefix(e){if(!e.startsWith(this._prefix))throw new Error("Mismatched prefix");let[t,s]=j(this._tree,e.slice(this._prefix.length));if(t===void 0){let[i,o]=Q(s);for(let r of i.keys())if(r!==y&&r.startsWith(o)){let c=new Map;return c.set(r.slice(o.length),i.get(r)),new n(c,e)}}return new n(t,e)}clear(){this._size=void 0,this._tree.clear()}delete(e){return this._size=void 0,Ie(this._tree,e)}entries(){return new O(this,xe)}forEach(e){for(let[t,s]of this)e(t,s,this)}fuzzyGet(e,t){return ze(this._tree,e,t)}get(e){let t=$(this._tree,e);return t!==void 0?t.get(y):void 0}has(e){let t=$(this._tree,e);return t!==void 0&&t.has(y)}keys(){return new O(this,ae)}set(e,t){if(typeof e!="string")throw new Error("key must be a string");return this._size=void 0,P(this._tree,e).set(y,t),this}get size(){if(this._size)return this._size;this._size=0;let e=this.entries();for(;!e.next().done;)this._size+=1;return this._size}update(e,t){if(typeof e!="string")throw new Error("key must be a string");this._size=void 0;let s=P(this._tree,e);return s.set(y,t(s.get(y))),this}fetch(e,t){if(typeof e!="string")throw new Error("key must be a string");this._size=void 0;let s=P(this._tree,e),i=s.get(y);return i===void 0&&s.set(y,i=t()),i}values(){return new O(this,ue)}[Symbol.iterator](){return this.entries()}static from(e){let t=new n;for(let[s,i]of e)t.set(s,i);return t}static fromObject(e){return n.from(Object.entries(e))}},j=(n,e,t=[])=>{if(e.length===0||n==null)return[n,t];for(let s of n.keys())if(s!==y&&e.startsWith(s))return t.push([n,s]),j(n.get(s),e.slice(s.length),t);return t.push([n,e]),j(void 0,"",t)},$=(n,e)=>{if(e.length===0||n==null)return n;for(let t of n.keys())if(t!==y&&e.startsWith(t))return $(n.get(t),e.slice(t.length))},P=(n,e)=>{let t=e.length;e:for(let s=0;n&&s<t;){for(let o of n.keys())if(o!==y&&e[s]===o[0]){let r=Math.min(t-s,o.length),c=1;for(;c<r&&e[s+c]===o[c];)++c;let a=n.get(o);if(c===o.length)n=a;else{let d=new Map;d.set(o.slice(c),a),n.set(e.slice(s,s+c),d),n.delete(o),n=d}s+=c;continue e}let i=new Map;return n.set(e.slice(s),i),i}return n},Ie=(n,e)=>{let[t,s]=j(n,e);if(t!==void 0){if(t.delete(y),t.size===0)le(s);else if(t.size===1){let[i,o]=t.entries().next().value;he(s,i,o)}}},le=n=>{if(n.length===0)return;let[e,t]=Q(n);if(e.delete(t),e.size===0)le(n.slice(0,-1));else if(e.size===1){let[s,i]=e.entries().next().value;s!==y&&he(n.slice(0,-1),s,i)}},he=(n,e,t)=>{if(n.length===0)return;let[s,i]=Q(n);s.set(i+e,t),s.delete(i)},Q=n=>n[n.length-1],U="or",fe="and",Oe="and_not",x=class n{constructor(e){if((e==null?void 0:e.fields)==null)throw new Error('MiniSearch: option "fields" must be provided');let t=e.autoVacuum==null||e.autoVacuum===!0?N:e.autoVacuum;this._options=Object.assign(Object.assign(Object.assign({},B),e),{autoVacuum:t,searchOptions:Object.assign(Object.assign({},ne),e.searchOptions||{}),autoSuggestOptions:Object.assign(Object.assign({},Le),e.autoSuggestOptions||{})}),this._index=new v,this._documentCount=0,this._documentIds=new Map,this._idToShortId=new Map,this._fieldIds={},this._fieldLength=new Map,this._avgFieldLength=[],this._nextId=0,this._storedFields=new Map,this._dirtCount=0,this._currentVacuum=null,this._enqueuedVacuum=null,this._enqueuedVacuumConditions=q,this.addFields(this._options.fields)}add(e){let{extractField:t,tokenize:s,processTerm:i,fields:o,idField:r}=this._options,c=t(e,r);if(c==null)throw new Error('MiniSearch: document does not have ID field "'.concat(r,'"'));if(this._idToShortId.has(c))throw new Error("MiniSearch: duplicate ID ".concat(c));let a=this.addDocumentId(c);this.saveStoredFields(a,e);for(let d of o){let u=t(e,d);if(u==null)continue;let h=s(u.toString(),d),l=this._fieldIds[d],p=new Set(h).size;this.addFieldLength(a,l,this._documentCount-1,p);for(let _ of h){let f=i(_,d);if(Array.isArray(f))for(let m of f)this.addTerm(l,a,m);else f&&this.addTerm(l,a,f)}}}addAll(e){for(let t of e)this.add(t)}addAllAsync(e,t={}){let{chunkSize:s=10}=t,i={chunk:[],promise:Promise.resolve()},{chunk:o,promise:r}=e.reduce(({chunk:c,promise:a},d,u)=>(c.push(d),(u+1)%s===0?{chunk:[],promise:a.then(()=>new Promise(h=>setTimeout(h,0))).then(()=>this.addAll(c))}:{chunk:c,promise:a}),i);return r.then(()=>this.addAll(o))}remove(e){let{tokenize:t,processTerm:s,extractField:i,fields:o,idField:r}=this._options,c=i(e,r);if(c==null)throw new Error('MiniSearch: document does not have ID field "'.concat(r,'"'));let a=this._idToShortId.get(c);if(a==null)throw new Error("MiniSearch: cannot remove document with ID ".concat(c,": it is not in the index"));for(let d of o){let u=i(e,d);if(u==null)continue;let h=t(u.toString(),d),l=this._fieldIds[d],p=new Set(h).size;this.removeFieldLength(a,l,this._documentCount,p);for(let _ of h){let f=s(_,d);if(Array.isArray(f))for(let m of f)this.removeTerm(l,a,m);else f&&this.removeTerm(l,a,f)}}this._storedFields.delete(a),this._documentIds.delete(a),this._idToShortId.delete(c),this._fieldLength.delete(a),this._documentCount-=1}removeAll(e){if(e)for(let t of e)this.remove(t);else{if(arguments.length>0)throw new Error("Expected documents to be present. Omit the argument to remove all documents.");this._index=new v,this._documentCount=0,this._documentIds=new Map,this._idToShortId=new Map,this._fieldLength=new Map,this._avgFieldLength=[],this._storedFields=new Map,this._nextId=0}}discard(e){let t=this._idToShortId.get(e);if(t==null)throw new Error("MiniSearch: cannot discard document with ID ".concat(e,": it is not in the index"));this._idToShortId.delete(e),this._documentIds.delete(t),this._storedFields.delete(t),(this._fieldLength.get(t)||[]).forEach((s,i)=>{this.removeFieldLength(t,i,this._documentCount,s)}),this._fieldLength.delete(t),this._documentCount-=1,this._dirtCount+=1,this.maybeAutoVacuum()}maybeAutoVacuum(){if(this._options.autoVacuum===!1)return;let{minDirtFactor:e,minDirtCount:t,batchSize:s,batchWait:i}=this._options.autoVacuum;this.conditionalVacuum({batchSize:s,batchWait:i},{minDirtCount:t,minDirtFactor:e})}discardAll(e){let t=this._options.autoVacuum;try{this._options.autoVacuum=!1;for(let s of e)this.discard(s)}finally{this._options.autoVacuum=t}this.maybeAutoVacuum()}replace(e){let{idField:t,extractField:s}=this._options,i=s(e,t);this.discard(i),this.add(e)}vacuum(e={}){return this.conditionalVacuum(e)}conditionalVacuum(e,t){return this._currentVacuum?(this._enqueuedVacuumConditions=this._enqueuedVacuumConditions&&t,this._enqueuedVacuum!=null?this._enqueuedVacuum:(this._enqueuedVacuum=this._currentVacuum.then(()=>{let s=this._enqueuedVacuumConditions;return this._enqueuedVacuumConditions=q,this.performVacuuming(e,s)}),this._enqueuedVacuum)):this.vacuumConditionsMet(t)===!1?Promise.resolve():(this._currentVacuum=this.performVacuuming(e),this._currentVacuum)}performVacuuming(e,t){return E(this,void 0,void 0,function*(){let s=this._dirtCount;if(this.vacuumConditionsMet(t)){let i=e.batchSize||J.batchSize,o=e.batchWait||J.batchWait,r=1;for(let[c,a]of this._index){for(let[d,u]of a)for(let[h]of u)this._documentIds.has(h)||(u.size<=1?a.delete(d):u.delete(h));this._index.get(c).size===0&&this._index.delete(c),r%i===0&&(yield new Promise(d=>setTimeout(d,o))),r+=1}this._dirtCount-=s}yield null,this._currentVacuum=this._enqueuedVacuum,this._enqueuedVacuum=null})}vacuumConditionsMet(e){if(e==null)return!0;let{minDirtCount:t,minDirtFactor:s}=e;return t=t||N.minDirtCount,s=s||N.minDirtFactor,this.dirtCount>=t&&this.dirtFactor>=s}get isVacuuming(){return this._currentVacuum!=null}get dirtCount(){return this._dirtCount}get dirtFactor(){return this._dirtCount/(1+this._documentCount+this._dirtCount)}has(e){return this._idToShortId.has(e)}getStoredFields(e){let t=this._idToShortId.get(e);if(t!=null)return this._storedFields.get(t)}search(e,t={}){let s=this.executeQuery(e,t),i=[];for(let[o,{score:r,terms:c,match:a}]of s){let d=c.length||1,u={id:this._documentIds.get(o),score:r*d,terms:Object.keys(a),queryTerms:c,match:a};Object.assign(u,this._storedFields.get(o)),(t.filter==null||t.filter(u))&&i.push(u)}return e===n.wildcard&&t.boostDocument==null&&this._options.searchOptions.boostDocument==null||i.sort(re),i}autoSuggest(e,t={}){t=Object.assign(Object.assign({},this._options.autoSuggestOptions),t);let s=new Map;for(let{score:o,terms:r}of this.search(e,t)){let c=r.join(" "),a=s.get(c);a!=null?(a.score+=o,a.count+=1):s.set(c,{score:o,terms:r,count:1})}let i=[];for(let[o,{score:r,terms:c,count:a}]of s)i.push({suggestion:o,terms:c,score:r/a});return i.sort(re),i}get documentCount(){return this._documentCount}get termCount(){return this._index.size}static loadJSON(e,t){if(t==null)throw new Error("MiniSearch: loadJSON should be given the same options used when serializing the index");return this.loadJS(JSON.parse(e),t)}static loadJSONAsync(e,t){return E(this,void 0,void 0,function*(){if(t==null)throw new Error("MiniSearch: loadJSON should be given the same options used when serializing the index");return this.loadJSAsync(JSON.parse(e),t)})}static getDefault(e){if(B.hasOwnProperty(e))return W(B,e);throw new Error('MiniSearch: unknown option "'.concat(e,'"'))}static loadJS(e,t){let{index:s,documentIds:i,fieldLength:o,storedFields:r,serializationVersion:c}=e,a=this.instantiateMiniSearch(e,t);a._documentIds=k(i),a._fieldLength=k(o),a._storedFields=k(r);for(let[d,u]of a._documentIds)a._idToShortId.set(u,d);for(let[d,u]of s){let h=new Map;for(let l of Object.keys(u)){let p=u[l];c===1&&(p=p.ds),h.set(parseInt(l,10),k(p))}a._index.set(d,h)}return a}static loadJSAsync(e,t){return E(this,void 0,void 0,function*(){let{index:s,documentIds:i,fieldLength:o,storedFields:r,serializationVersion:c}=e,a=this.instantiateMiniSearch(e,t);a._documentIds=yield A(i),a._fieldLength=yield A(o),a._storedFields=yield A(r);for(let[u,h]of a._documentIds)a._idToShortId.set(h,u);let d=0;for(let[u,h]of s){let l=new Map;for(let p of Object.keys(h)){let _=h[p];c===1&&(_=_.ds),l.set(parseInt(p,10),yield A(_))}++d%1e3===0&&(yield pe(0)),a._index.set(u,l)}return a})}static instantiateMiniSearch(e,t){let{documentCount:s,nextId:i,fieldIds:o,averageFieldLength:r,dirtCount:c,serializationVersion:a}=e;if(a!==1&&a!==2)throw new Error("MiniSearch: cannot deserialize an index created with an incompatible version");let d=new n(t);return d._documentCount=s,d._nextId=i,d._idToShortId=new Map,d._fieldIds=o,d._avgFieldLength=r,d._dirtCount=c||0,d._index=new v,d}executeQuery(e,t={}){if(e===n.wildcard)return this.executeWildcardQuery(t);if(typeof e!="string"){let l=Object.assign(Object.assign(Object.assign({},t),e),{queries:void 0}),p=e.queries.map(_=>this.executeQuery(_,l));return this.combineResults(p,l.combineWith)}let{tokenize:s,processTerm:i,searchOptions:o}=this._options,r=Object.assign(Object.assign({tokenize:s,processTerm:i},o),t),{tokenize:c,processTerm:a}=r,h=c(e).flatMap(l=>a(l)).filter(l=>!!l).map(Ce(r)).map(l=>this.executeQuerySpec(l,r));return this.combineResults(h,r.combineWith)}executeQuerySpec(e,t){let s=Object.assign(Object.assign({},this._options.searchOptions),t),i=(s.fields||this._options.fields).reduce((f,m)=>Object.assign(Object.assign({},f),{[m]:W(s.boost,m)||1}),{}),{boostDocument:o,weights:r,maxFuzzy:c,bm25:a}=s,{fuzzy:d,prefix:u}=Object.assign(Object.assign({},ne.weights),r),h=this._index.get(e.term),l=this.termResults(e.term,e.term,1,e.termBoost,h,i,o,a),p,_;if(e.prefix&&(p=this._index.atPrefix(e.term)),e.fuzzy){let f=e.fuzzy===!0?.2:e.fuzzy,m=f<1?Math.min(c,Math.round(e.term.length*f)):f;m&&(_=this._index.fuzzyGet(e.term,m))}if(p)for(let[f,m]of p){let S=f.length-e.term.length;if(!S)continue;_==null||_.delete(f);let b=u*f.length/(f.length+.3*S);this.termResults(e.term,f,b,e.termBoost,m,i,o,a,l)}if(_)for(let f of _.keys()){let[m,S]=_.get(f);if(!S)continue;let b=d*f.length/(f.length+S);this.termResults(e.term,f,b,e.termBoost,m,i,o,a,l)}return l}executeWildcardQuery(e){let t=new Map,s=Object.assign(Object.assign({},this._options.searchOptions),e);for(let[i,o]of this._documentIds){let r=s.boostDocument?s.boostDocument(o,"",this._storedFields.get(i)):1;t.set(i,{score:r,terms:[],match:{}})}return t}combineResults(e,t=U){if(e.length===0)return new Map;let s=t.toLowerCase(),i=ve[s];if(!i)throw new Error("Invalid combination operator: ".concat(t));return e.reduce(i)||new Map}toJSON(){let e=[];for(let[t,s]of this._index){let i={};for(let[o,r]of s)i[o]=Object.fromEntries(r);e.push([t,i])}return{documentCount:this._documentCount,nextId:this._nextId,documentIds:Object.fromEntries(this._documentIds),fieldIds:this._fieldIds,fieldLength:Object.fromEntries(this._fieldLength),averageFieldLength:this._avgFieldLength,storedFields:Object.fromEntries(this._storedFields),dirtCount:this._dirtCount,index:e,serializationVersion:2}}termResults(e,t,s,i,o,r,c,a,d=new Map){if(o==null)return d;for(let u of Object.keys(r)){let h=r[u],l=this._fieldIds[u],p=o.get(l);if(p==null)continue;let _=p.size,f=this._avgFieldLength[l];for(let m of p.keys()){if(!this._documentIds.has(m)){this.removeTerm(l,m,t),_-=1;continue}let S=c?c(this._documentIds.get(m),t,this._storedFields.get(m)):1;if(!S)continue;let b=p.get(m),V=this._fieldLength.get(m)[l],R=Me(b,_,this._documentCount,V,f,a),M=s*i*h*S*R,w=d.get(m);if(w){w.score+=M,ke(w.terms,e);let I=W(w.match,t);I?I.push(u):w.match[t]=[u]}else d.set(m,{score:M,terms:[e],match:{[t]:[u]}})}}return d}addTerm(e,t,s){let i=this._index.fetch(s,ce),o=i.get(e);if(o==null)o=new Map,o.set(t,1),i.set(e,o);else{let r=o.get(t);o.set(t,(r||0)+1)}}removeTerm(e,t,s){if(!this._index.has(s)){this.warnDocumentChanged(t,e,s);return}let i=this._index.fetch(s,ce),o=i.get(e);o==null||o.get(t)==null?this.warnDocumentChanged(t,e,s):o.get(t)<=1?o.size<=1?i.delete(e):o.delete(t):o.set(t,o.get(t)-1),this._index.get(s).size===0&&this._index.delete(s)}warnDocumentChanged(e,t,s){for(let i of Object.keys(this._fieldIds))if(this._fieldIds[i]===t){this._options.logger("warn","MiniSearch: document with ID ".concat(this._documentIds.get(e),' has changed before removal: term "').concat(s,'" was not present in field "').concat(i,'". Removing a document after it has changed can corrupt the index!'),"version_conflict");return}}addDocumentId(e){let t=this._nextId;return this._idToShortId.set(e,t),this._documentIds.set(t,e),this._documentCount+=1,this._nextId+=1,t}addFields(e){for(let t=0;t<e.length;t++)this._fieldIds[e[t]]=t}addFieldLength(e,t,s,i){let o=this._fieldLength.get(e);o==null&&this._fieldLength.set(e,o=[]),o[t]=i;let c=(this._avgFieldLength[t]||0)*s+i;this._avgFieldLength[t]=c/(s+1)}removeFieldLength(e,t,s,i){if(s===1){this._avgFieldLength[t]=0;return}let o=this._avgFieldLength[t]*s-i;this._avgFieldLength[t]=o/(s-1)}saveStoredFields(e,t){let{storeFields:s,extractField:i}=this._options;if(s==null||s.length===0)return;let o=this._storedFields.get(e);o==null&&this._storedFields.set(e,o={});for(let r of s){let c=i(t,r);c!==void 0&&(o[r]=c)}}};x.wildcard=Symbol("*");var W=(n,e)=>Object.prototype.hasOwnProperty.call(n,e)?n[e]:void 0,ve={[U]:(n,e)=>{for(let t of e.keys()){let s=n.get(t);if(s==null)n.set(t,e.get(t));else{let{score:i,terms:o,match:r}=e.get(t);s.score=s.score+i,s.match=Object.assign(s.match,r),oe(s.terms,o)}}return n},[fe]:(n,e)=>{let t=new Map;for(let s of e.keys()){let i=n.get(s);if(i==null)continue;let{score:o,terms:r,match:c}=e.get(s);oe(i.terms,r),t.set(s,{score:i.score+o,terms:i.terms,match:Object.assign(i.match,c)})}return t},[Oe]:(n,e)=>{for(let t of e.keys())n.delete(t);return n}},Fe={k:1.2,b:.7,d:.5},Me=(n,e,t,s,i,o)=>{let{k:r,b:c,d:a}=o;return Math.log(1+(t-e+.5)/(e+.5))*(a+n*(r+1)/(n+r*(1-c+c*s/i)))},Ce=n=>(e,t,s)=>{let i=typeof n.fuzzy=="function"?n.fuzzy(e,t,s):n.fuzzy||!1,o=typeof n.prefix=="function"?n.prefix(e,t,s):n.prefix===!0,r=typeof n.boostTerm=="function"?n.boostTerm(e,t,s):1;return{term:e,fuzzy:i,prefix:o,termBoost:r}},B={idField:"id",extractField:(n,e)=>n[e],tokenize:n=>n.split(Ae),processTerm:n=>n.toLowerCase(),fields:void 0,searchOptions:void 0,storeFields:[],logger:(n,e)=>{typeof(console==null?void 0:console[n])=="function"&&console[n](e)},autoVacuum:!0},ne={combineWith:U,prefix:!1,fuzzy:!1,maxFuzzy:6,boost:{},weights:{fuzzy:.45,prefix:.375},bm25:Fe},Le={combineWith:fe,prefix:(n,e,t)=>e===t.length-1},J={batchSize:1e3,batchWait:10},q={minDirtFactor:.1,minDirtCount:20},N=Object.assign(Object.assign({},J),q),ke=(n,e)=>{n.includes(e)||n.push(e)},oe=(n,e)=>{for(let t of e)n.includes(t)||n.push(t)},re=({score:n},{score:e})=>e-n,ce=()=>new Map,k=n=>{let e=new Map;for(let t of Object.keys(n))e.set(parseInt(t,10),n[t]);return e},A=n=>E(void 0,void 0,void 0,function*(){let e=new Map,t=0;for(let s of Object.keys(n))e.set(parseInt(s,10),n[s]),++t%1e3===0&&(yield pe(0));return e}),pe=n=>new Promise(e=>setTimeout(e,n)),Ae=/[\n\r\p{Z}\p{P}]+/u;var _e=be(Se(),1);var F,T,ye,me=class{constructor(e){D(this,T);C(this,"mapData");C(this,"indexes");C(this,"ready");D(this,F);this.mapData=e,this.indexes=Te(e),this.ready=this.populate(),Y(this,F,H(Z(this,T,ye).bind(this),2e3))}async populate(){let{places:e,enterpriseLocations:t,enterpriseCategories:s}=this.indexes,i=this.mapData,o=[];return e.removeAll(),o=o.concat([e.addAllAsync(i.getByType("space")),e.addAllAsync(i.getByType("point-of-interest")),e.addAllAsync(i.getByType("connection")),e.addAllAsync(i.getByType("floor")),e.addAllAsync(i.getByType("door")),e.addAllAsync(i.getByType("annotation")),e.addAllAsync(i.getByType("area"))]),t&&(t==null||t.removeAll(),o.push(t.addAllAsync(i.getByType("enterprise-location")))),s&&(s==null||s.removeAll(),o.push(s.addAllAsync(i.getByType("enterprise-category")))),Promise.all(o)}async search(e,t={}){var a,d;await this.ready,Ve.parse(t);let s=(0,_e.default)({},t,je),i=this.indexes.places.search(e,{fields:Object.keys(s.places.fields).filter(u=>s.places.fields[u])});s.places.limit&&(i=i.slice(0,s.places.limit));let o=(a=this.indexes.enterpriseLocations)==null?void 0:a.search(e,{fields:Object.keys(s.enterpriseLocations.fields).filter(u=>s.enterpriseLocations.fields[u])});o&&s.enterpriseLocations.limit&&(o=o.slice(0,s.enterpriseLocations.limit));let r=(d=this.indexes.enterpriseCategories)==null?void 0:d.search(e,{fields:Object.keys(s.enterpriseCategories.fields).filter(u=>s.enterpriseCategories.fields[u])});r&&s.enterpriseCategories.limit&&(r=r.slice(0,s.enterpriseCategories.limit));let c=Ee(this.mapData,{placesResult:i,locationsResult:o,categoriesResult:r});return K(this,F).call(this,e),c}async suggest(e,t={}){await this.ready,Re.parse(t);let s=[],{places:{enabled:i=!0}={},enterpriseLocations:{enabled:o=!0}={}}=t;return o&&this.indexes.enterpriseLocations&&this.indexes.enterpriseLocations.autoSuggest(e,{fields:["name","tags"],combineWith:"AND",prefix:!0,boost:{name:2,tags:1}}).forEach(r=>s.push(r)),i&&this.indexes.places.autoSuggest(e,{fields:["name"],combineWith:"AND",prefix:!0}).forEach(r=>s.push(r)),s.sort((r,c)=>c.score-r.score),this.mapData.Analytics.capture("$query-suggest",{query:e,suggestions:s.map(r=>r.suggestion)}),s}};F=new WeakMap,T=new WeakSet,ye=function(e){this.mapData.Analytics.capture("$query-search",{query:e})};function Ee(n,{placesResult:e,locationsResult:t,categoriesResult:s}){let i=e.reduce((c,{id:a,match:d,score:u,__type:h})=>{let l=n.getById(h,a);return l!=null&&!X.is(l)&&!ee.is(l)&&!te.is(l)&&!se.is(l)&&!ie.is(l)&&c.push({type:l.__type,match:d,score:u,item:l}),c},[]),o;if(t){o=[];for(let{id:c,match:a,score:d}of t){let u=n.getById("enterprise-location",c);u&&o.push({type:u.__type,match:a,score:d,item:u})}}let r;if(s){r=[];for(let{id:c,match:a,score:d}of s){let u=n.getById("enterprise-category",c);u&&r.push({type:u.__type,match:a,score:d,item:u})}}return{places:i,enterpriseLocations:o,enterpriseCategories:r}}var je={places:{fields:{name:!0,description:!0}},enterpriseCategories:{fields:{name:!0,description:!1,"locations.name":!0}},enterpriseLocations:{fields:{name:!0,tags:!0,description:!0}}};function G(n){return n.normalize("NFD").replace(/[\u0300-\u036f|\u2019|\u0027|\']/g,"").toLowerCase()}function Te(n){let e=new x({fields:["name","description"],storeFields:["id","__type"],searchOptions:{fuzzy:.2,prefix:!0,boost:{name:2},combineWith:"AND"},extractField:(r,c)=>{let a=r[c];return typeof a=="string"?G(a):r[c]},processTerm:r=>De.has(r)?"":r.toLowerCase()}),t=n.getByType("enterprise-location"),s;t&&(s=new x({fields:["name","tags","description"],storeFields:["id","__type"],searchOptions:{combineWith:"OR",prefix:!0,fuzzy:.2,boost:{name:3,tags:2,description:1}},extractField:(r,c)=>Array.isArray(r[c])?r[c].join(" "):typeof r[c]=="string"?G(r[c]):r[c]}));let i=n.getByType("enterprise-category"),o;return i&&(o=new x({fields:["name","description","locations.name"],storeFields:["id","__type"],extractField(r,c){return c==="locations.name"?r.locations.reduce((d,u)=>d+" ".concat(ge," ")+u.name,"")+" ".concat(ge):typeof r[c]=="string"?G(r[c]):r[c]},searchOptions:{combineWith:"OR",prefix:!0,fuzzy:.2,boost:{name:2,"locations.name":2}}})),{enterpriseCategories:o,enterpriseLocations:s,places:e}}var Ve=g.object({places:g.object({fields:g.object({name:g.boolean().optional(),description:g.boolean().optional()}).optional(),limit:g.number().positive().optional()}).optional(),enterpriseCategories:g.object({fields:g.object({name:g.boolean().optional(),description:g.boolean().optional(),"locations.name":g.boolean().optional()}).optional(),limit:g.number().positive().optional()}).optional(),enterpriseLocations:g.object({fields:g.object({name:g.boolean().optional(),tags:g.boolean().optional(),description:g.boolean().optional()}).optional(),limit:g.number().positive().optional()}).optional()}),Re=g.object({places:g.object({enabled:g.boolean().optional()}).optional(),enterpriseLocations:g.object({enabled:g.boolean().optional()}).optional()}),De=new Set(["the","an","and","or","of","in","on","at","to","from","with","by","for"]),ge="";export{me as InternalSearch,G as removeAccents};
